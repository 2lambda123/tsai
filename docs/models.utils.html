---

title: Models utils


keywords: fastai
sidebar: home_sidebar

summary: "Utility functions used to build PyTorch timeseries models."
description: "Utility functions used to build PyTorch timeseries models."
nb_path: "nbs/100_models.utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/100_models.utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_layers" class="doc_header"><code>get_layers</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_layers</code>(<strong><code>model</code></strong>, <strong><code>cond</code></strong>=<em><code>noop</code></em>, <strong><code>full</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_layer" class="doc_header"><code>is_layer</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_layer</code>(<strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_linear" class="doc_header"><code>is_linear</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_linear</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_bn" class="doc_header"><code>is_bn</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_bn</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_conv_linear" class="doc_header"><code>is_conv_linear</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_conv_linear</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_affine_layer" class="doc_header"><code>is_affine_layer</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_affine_layer</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_conv" class="doc_header"><code>is_conv</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_conv</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="has_bias" class="doc_header"><code>has_bias</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>has_bias</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="has_weight" class="doc_header"><code>has_weight</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>has_weight</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="has_weight_or_bias" class="doc_header"><code>has_weight_or_bias</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>has_weight_or_bias</code>(<strong><code>l</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_bias" class="doc_header"><code>check_bias</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_bias</code>(<strong><code>m</code></strong>, <strong><code>cond</code></strong>=<em><code>noop</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_weight" class="doc_header"><code>check_weight</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_weight</code>(<strong><code>m</code></strong>, <strong><code>cond</code></strong>=<em><code>noop</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_model" class="doc_header"><code>create_model</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L71" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_model</code>(<strong><code>arch</code></strong>, <strong><code>c_in</code></strong>=<em><code>None</code></em>, <strong><code>c_out</code></strong>=<em><code>None</code></em>, <strong><code>seq_len</code></strong>=<em><code>None</code></em>, <strong><code>dls</code></strong>=<em><code>None</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_tabular_model" class="doc_header"><code>create_tabular_model</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L94" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_tabular_model</code>(<strong><code>arch</code></strong>, <strong><code>dls</code></strong>, <strong><code>layers</code></strong>=<em><code>None</code></em>, <strong><code>emb_szs</code></strong>=<em><code>None</code></em>, <strong><code>n_out</code></strong>=<em><code>None</code></em>, <strong><code>y_range</code></strong>=<em><code>None</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>, <strong><code>ps</code></strong>=<em><code>None</code></em>, <strong><code>embed_p</code></strong>=<em><code>0.0</code></em>, <strong><code>use_bn</code></strong>=<em><code>True</code></em>, <strong><code>bn_final</code></strong>=<em><code>False</code></em>, <strong><code>bn_cont</code></strong>=<em><code>True</code></em>, <strong><code>act_cls</code></strong>=<em><code>ReLU(inplace=True)</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_parameters" class="doc_header"><code>count_parameters</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L105" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_parameters</code>(<strong><code>model</code></strong>, <strong><code>trainable</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;MLSTM_FCN&#39;</span>
<span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RNN_FCN&#39;</span><span class="p">,</span> <span class="s1">&#39;LSTM_FCN&#39;</span><span class="p">,</span> <span class="s1">&#39;GRU_FCN&#39;</span><span class="p">,</span> <span class="s1">&#39;OmniScaleCNN&#39;</span><span class="p">,</span> <span class="s1">&#39;Transformer&#39;</span><span class="p">,</span> <span class="s1">&#39;mWDN&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]):</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_clones" class="doc_header"><code>get_clones</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L110" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_clones</code>(<strong><code>module</code></strong>, <strong><code>N</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">get_clones</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ModuleList(
  (0): Conv1d(3, 4, kernel_size=(3,), stride=(1,))
  (1): Conv1d(3, 4, kernel_size=(3,), stride=(1,))
  (2): Conv1d(3, 4, kernel_size=(3,), stride=(1,))
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_nf" class="doc_header"><code>get_nf</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L114" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_nf</code>(<strong><code>m</code></strong>)</p>
</blockquote>
<p>Get nf from model's last linear layer</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
<span class="n">layers</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)]</span>
<span class="n">layers</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="n">layers</span> <span class="o">+=</span> <span class="p">[</span><span class="n">SigmoidRange</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))]</span>
<span class="n">layers</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
<span class="n">get_nf</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>100</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_model" class="doc_header"><code>split_model</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L120" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_model</code>(<strong><code>model</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="seq_len_calculator" class="doc_header"><code>seq_len_calculator</code><a href="https://github.com/timeseriesAI/tsai/tree/master/tsai/models/utils.py#L130" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>seq_len_calculator</code>(<strong><code>seq_len</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq_len</span> <span class="o">=</span> <span class="mi">345</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">seq_len_calculator</span><span class="p">(</span><span class="n">seq_len</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>69</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

